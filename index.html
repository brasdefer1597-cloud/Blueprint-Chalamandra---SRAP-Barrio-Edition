<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blueprint Chalamandra - SRAP Barrio Edition</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carga de fuentes para el estilo "Graffiti/Neon" -->
    <link href="https://fonts.googleapis.com/css2?family=Monoton&family=Inter:wght@400;700;900;1000&display=swap" rel="stylesheet">
    <style>
        /* Variables y Estilos Generales "Barrio Warrior" */
        :root {
            --neon-pink: #ff007f;
            --neon-blue: #00ffff;
            --neon-lime: #ccff00;
            --neon-red: #ff3131;
            --neon-purple: #bf00ff;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d0d0d; /* Fondo oscuro casi negro */
        }
        .graffiti-title {
            font-family: 'Monoton', cursive;
            text-shadow: 
                0 0 5px var(--neon-pink),
                0 0 15px var(--neon-pink),
                0 0 30px var(--neon-pink);
            color: #fff;
            line-height: 1.1;
        }
        .cta-button {
            background-color: var(--neon-lime);
            color: #1a1a1a;
            font-weight: 900;
            text-transform: uppercase;
            box-shadow: 0 0 10px var(--neon-lime);
            transition: all 0.2s ease;
        }
        .cta-button:hover {
            background-color: #e0ff40;
            box-shadow: 0 0 20px var(--neon-lime);
            transform: scale(1.05);
        }

        /* Nav y Botones de Nivel */
        .nav-level-button {
            transition: all 0.2s ease;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.2);
        }
        .nav-level-button:hover:not(.nav-active) {
            transform: scale(1.1);
        }
        .nav-active {
            background-color: var(--neon-pink);
            color: #1a1a1a;
            box-shadow: 0 0 15px var(--neon-pink);
            font-weight: 900;
        }
        .nav-locked {
            opacity: 0.3;
            cursor: not-allowed;
            background-color: #333;
        }

        /* Estilos espec√≠ficos de Nivel 2, 3 y 5 (manteniendo el flow) */
        .srap-step, .chaos-ritual, .mandala-hat {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .srap-step { border-left: 4px solid var(--neon-blue); background: rgba(0, 255, 255, 0.05); }
        .srap-step:hover { transform: translateX(5px) scale(1.02); box-shadow: 0 0 15px var(--neon-blue); }
        .srap-active { border-left: 4px solid var(--neon-lime); background: rgba(204, 255, 0, 0.1); }
        
        .chaos-ritual { border: 2px solid var(--neon-red); background: rgba(255, 49, 49, 0.1); }
        .chaos-ritual:hover { box-shadow: 0 0 15px var(--neon-red); transform: scale(1.02); }
        
        .mandala-hat { border: 2px solid var(--neon-purple); background: rgba(191, 0, 255, 0.1); }
        .mandala-hat:hover { box-shadow: 0 0 20px var(--neon-purple); transform: translateY(-5px); background: rgba(191, 0, 255, 0.2); }
        .hat-insight { max-height: 0; overflow: hidden; transition: max-height 0.5s ease, opacity 0.5s ease; opacity: 0; }
        .hat-revealed .hat-insight { max-height: 150px; opacity: 1; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px dashed rgba(255,255,255,0.3); }

        /* Icono de Salamandra */
        .salamandra {
            display: inline-block;
            transform: rotate(-10deg);
            animation: dance 2s infinite alternate;
        }
        @keyframes dance {
            from { transform: rotate(-10deg) scale(1); }
            to { transform: rotate(10deg) scale(1.05); }
        }

        /* Estilos del Modal Personalizado (Reemplazo de alert()) */
        #custom-modal {
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 50;
        }
        #modal-content {
            background-color: #1a1a1a;
            border: 2px solid var(--neon-lime);
            box-shadow: 0 0 30px var(--neon-lime);
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="p-4 min-h-screen flex flex-col justify-between">

    <!-- BARRA DE NAVEGACI√ìN Y CONTADOR GLOBAL -->
    <header class="fixed top-0 left-0 right-0 p-4 bg-gray-900/90 shadow-2xl z-20 flex items-center justify-between">
        
        <div id="nav-container" class="flex space-x-2">
            <button id="nav-btn-0" onclick="renderLevel(0)" class="nav-level-button bg-gray-700 text-white p-2 rounded-lg text-xs font-bold w-12">HOME</button>
            <button id="nav-btn-2" onclick="renderLevel(2)" class="nav-level-button bg-gray-700 text-white p-2 rounded-lg text-xs font-bold w-12 nav-locked">N. 2</button>
            <button id="nav-btn-3" onclick="renderLevel(3)" class="nav-level-button bg-gray-700 text-white p-2 rounded-lg text-xs font-bold w-12 nav-locked">N. 3</button>
            <button id="nav-btn-5" onclick="renderLevel(5)" class="nav-level-button bg-gray-700 text-white p-2 rounded-lg text-xs font-bold w-12 nav-locked">N. 5</button>
        </div>

        <!-- Contador de Gamificaci√≥n (Global) -->
        <div class="bg-gray-800 p-2 rounded-xl shadow-lg border border-lime-500/50">
            <p class="text-xs font-bold text-lime-400 uppercase">Insight üéØ</p>
            <p id="insight-counter" class="text-xl font-black text-white">0</p>
        </div>
    </header>

    <!-- Contenido Principal: Control de Vistas -->
    <main class="text-white text-center flex-grow flex flex-col items-center justify-center pt-20 pb-4">
        
        <h1 id="main-title" class="graffiti-title text-4xl sm:text-5xl mb-8 font-extrabold text-white"></h1>

        <!-- SECCIONES DE NIVELES -->
        
        <!-- Nivel 0 ‚Äì Hero / Welcome Boss -->
        <section id="level-0" class="level-section w-full max-w-lg hidden transition-opacity duration-500">
            <p class="text-lime-400 text-lg sm:text-xl mb-6 max-w-md italic font-semibold mx-auto">
                ‚ÄúOrale mi carnala, bienvenid@ al caos chido: descubre tu **CHAOS Factor** y domina tu flow.‚Äù
            </p>
            
            <p class="text-base text-gray-400 mb-8">
                Chola, Malandra o Fresa‚Ä¶ ¬øqui√©n manda hoy? <br/>
            </p>

            <div class="w-full grid grid-cols-3 gap-6 mb-12">
                <!-- Los 3 arquetipos (NPCs) -->
                <div class="p-3 rounded-xl border-2 border-neon-pink bg-pink-900/20"><p class="font-black text-xl text-neon-pink">CHOLA</p></div>
                <div class="p-3 rounded-xl border-2 border-neon-lime bg-lime-900/20"><p class="font-black text-xl text-neon-lime">MALANDRA</p></div>
                <div class="p-3 rounded-xl border-2 border-neon-blue bg-cyan-900/20"><p class="font-black text-xl text-neon-blue">FRESA</p></div>
            </div>
            
            <button onclick="unlockAndRenderLevel(2)" class="cta-button px-8 py-3 rounded-full text-base sm:text-lg tracking-wider">
                ¬°V√°monos pal Nivel 2 (SRAP)! üöÄ
            </button>
        </section>


        <!-- Nivel 2 ‚Äì SRAP Barrio Edition (Premium: Tarea de Reflexi√≥n) -->
        <section id="level-2" class="level-section w-full max-w-xl hidden transition-opacity duration-500 flex-col">
            <p class="text-base text-gray-400 mb-6 font-semibold">
                Scan ‚Üí Respira ‚Üí Alinea ‚Üí Pausa, pero con flow cholo-fresa-malandra. **La DOMINACI√ìN se logra al completar la Tarea de Reflexi√≥n antes de hacer click.**
            </p>

            <div id="srap-steps-container" class="space-y-4">
                <div id="srap-scan" class="srap-step p-4 rounded-r-lg" onclick="collectInsight(this, 'srap-scan', 1)">
                    <p class="srap-title text-xl font-bold text-neon-blue">1. SCAN üîç (El Sensor)</p>
                    <p class="text-sm text-gray-300 mt-1">Mira tu caos alrededor, ¬øqu√© te est√° frenando? **Tarea:** Nombra 1 impulso sin juzgarlo.</p>
                </div>
                <div id="srap-respira" class="srap-step p-4 rounded-r-lg" onclick="collectInsight(this, 'srap-respira', 1)">
                    <p class="srap-title text-xl font-bold text-neon-blue">2. RESPIRA üßò‚Äç‚ôÄÔ∏è (El Ancla)</p>
                    <p class="text-sm text-gray-300 mt-1">Toma 3 segundos para tu flow interno. **Tarea:** Identifica el sentimiento ra√≠z (no la reacci√≥n).</p>
                </div>
                <div id="srap-alinea" class="srap-step p-4 rounded-r-lg" onclick="collectInsight(this, 'srap-alinea', 2)">
                    <p class="srap-title text-xl font-bold text-neon-blue">3. ALINEA üéØ (El GPS)</p>
                    <p class="text-sm text-gray-300 mt-1">Conecta emoci√≥n + raz√≥n ‚Üí tu ritmo real. **Tarea Premium:** Escribe 1 frase de intenci√≥n poderosa (+2 Insights).</p>
                </div>
                <div id="srap-pausa" class="srap-step p-4 rounded-r-lg" onclick="collectInsight(this, 'srap-pausa', 1)">
                    <p class="srap-title text-xl font-bold text-neon-blue">4. PAUSA üõë (La Estrategia)</p>
                    <p class="text-sm text-gray-300 mt-1">Observa y act√∫a con estrategia warrior. **Tarea:** Define el primer paso concreto.</p>
                </div>
            </div>

            <button onclick="unlockAndRenderLevel(3)" class="cta-button mt-10 px-8 py-3 rounded-full text-base sm:text-lg tracking-wider">
                ¬°Nivel 3: Caos Controlado! üå™
            </button>
        </section>


        <!-- Nivel 3 ‚Äì Caos Controlado (Premium: Generaci√≥n de Ideas) -->
        <section id="level-3" class="level-section w-full max-w-xl hidden transition-opacity duration-500 flex-col">
            <p class="text-base text-gray-400 mb-6 font-semibold">
                Es hora del desmadre calculado, warrior: usa tu caos como arma secreta. **El Dominio requiere que ejecutes el Ritual en un problema real y registres tu intento con el click.**
            </p>

            <div id="chaos-rituals-container" class="space-y-4 text-left">
                <div class="chaos-ritual p-4 rounded-xl" onclick="startChaosRitual('error')">
                    <p class="chaos-title text-xl font-bold">1. Error Creativo üí• (El Prototipo R√°pido - RIESGO ALTO)</p>
                    <p class="text-xs text-gray-300 mt-1">Prueba un error creativo y aprende algo raro pero √∫til. **+1 Desastre, posible SUPER INSIGHT o Penalizaci√≥n.**</p>
                </div>
                <div class="chaos-ritual p-4 rounded-xl" onclick="startChaosRitual('fiesta')">
                    <p class="chaos-title text-xl font-bold">2. Fiesta Estrat√©gica üåÆ (Lluvia de Ideas sin Filtro - SEGURO)</p>
                    <p class="text-xs text-gray-300 mt-1">Genera ideas sin filtro (Graffiti o Salsa mental). **+2 Desastre, +2 Insights garantizados.**</p>
                </div>
            </div>

            <div class="mt-8 bg-gray-900/80 p-4 rounded-xl border border-lime-500/50">
                <p class="text-sm text-lime-400 uppercase font-bold">M√©trica de Desmadre:</p>
                <p id="chaos-metric-display" class="font-bold text-white text-lg mt-1">--</p>
            </div>

             <button onclick="unlockAndRenderLevel(5)" class="cta-button mt-10 px-8 py-3 rounded-full text-base sm:text-lg tracking-wider">
                ¬°Nivel 5: Mandala Multiconsciente! üé©
            </button>
        </section>


        <!-- Nivel 5 ‚Äì Sombreros / Mandala Multiconsciente (Premium: Insights Ocultos) -->
        <section id="level-5" class="level-section w-full max-w-2xl hidden transition-opacity duration-500 flex-col">
            <p class="text-base text-gray-400 mb-8 font-semibold max-w-md mx-auto">
                Pon tu flow en orden: Creativo, Cr√≠tico, T√°ctico, y un poquito de fresa. (¬°Busca la Sinergia!) **El Insight se gana al ejecutar la Tarea que revela cada Perspectiva/Rol.**
            </p>

            <!-- Grid de Sombreros -->
            <div class="grid grid-cols-2 gap-4 text-left">
                
                <div id="hat-creativo" class="mandala-hat p-4 rounded-xl" onclick="revealHatInsight(this, 'creativo', '¬°Boom! Hoy se vale todo. Mezcla ballet con reggaet√≥n mental.')">
                    <div class="hat-icon">üé®</div>
                    <p class="text-lg font-bold text-purple-300">CREATIVO (+3 Insights)</p>
                    <div class="hat-insight text-sm text-white"><p>Tu tarea: Genera 3 soluciones absurdas al problema que tengas. El caos premia la imaginaci√≥n.</p></div>
                </div>

                <div id="hat-critico" class="mandala-hat p-4 rounded-xl" onclick="revealHatInsight(this, 'critico', 'Ojo de √°guila, carnala. ¬øEse patr√≥n te sirve o te estorba?')">
                    <div class="hat-icon">üßê</div>
                    <p class="text-lg font-bold text-purple-300">CR√çTICO (+3 Insights)</p>
                    <div class="hat-insight text-sm text-white"><p>Tu tarea: Identifica el mayor riesgo de tus 3 soluciones. No es pesimismo, es estrategia pura.</p></div>
                </div>

                <div id="hat-tactico" class="mandala-hat p-4 rounded-xl" onclick="revealHatInsight(this, 'tactico', 'Desmadre con objetivo. Mueve esa ficha y gana la partida.')">
                    <div class="hat-icon">‚ôüÔ∏è</div>
                    <p class="text-lg font-bold text-purple-300">T√ÅCTICO (+3 Insights)</p>
                    <div class="hat-insight text-sm text-white"><p>Tu tarea: Combina la mejor soluci√≥n con el menor riesgo. Acci√≥n simple y directa.</p></div>
                </div>

                <div id="hat-fresa" class="mandala-hat p-4 rounded-xl" onclick="revealHatInsight(this, 'fresa', 'Hazlo bien o no lo hagas. Flow VIP en zona de guerra.')">
                    <div class="hat-icon">üçì</div>
                    <p class="text-lg font-bold text-purple-300">FRESA (+3 Insights)</p>
                    <div class="hat-insight text-sm text-white"><p>Tu tarea: Define tu est√°ndar de excelencia (el "flow VIP"). ¬øQu√© te hace sentir imparable?</p></div>
                </div>
            </div>

            <button onclick="showCustomAlert('¬°Felicidades Warrior! Has completado la demo PREMIUM del Blueprint Chalamandra. ¬°Nos vemos en el Caos!')" class="cta-button mt-10 px-8 py-3 rounded-full text-base sm:text-lg tracking-wider">
                ¬°Finalizar Demo! üèÜ
            </button>
        </section>

    </main>
    
    <!-- MODAL DE ALERTA PERSONALIZADO (Reemplazo de alert()) -->
    <div id="custom-modal" class="fixed inset-0 hidden items-center justify-center p-4">
        <div id="modal-content" class="max-w-md w-full p-6 rounded-2xl text-center">
            <h3 id="modal-title" class="text-2xl font-black text-lime-400 mb-3">¬°Insight Revelado!</h3>
            <p id="modal-message" class="text-white mb-6 text-base"></p>
            <button onclick="hideCustomAlert()" class="cta-button px-6 py-2 rounded-full text-sm">
                Entendido, Carnal
            </button>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="text-center text-gray-600 text-xs mt-4">
        <p class="salamandra">üêâ</p> 
        <p>*Salamandras bailando ballet folkl√≥rico con flow.</p>
    </footer>

    <script>
        // === 1. ESTADO CENTRAL DEL JUEGO (GAMESTATE) ===
        const gameState = {
            currentLevel: 0,
            insightPoints: 0,
            epicDisasterLevel: 0,
            collectedSteps: {}, // Pasos SRAP completados
            collectedHats: {},  // Sombreros activados
            hatSequence: [],    // Secuencia de sombreros activados para el bonus de sinergia
            unlockedLevels: { 0: true, 2: false, 3: false, 5: false }
        };

        // === 2. REFERENCIAS Y MAPEO DE UI ===
        const levelSections = document.querySelectorAll('.level-section');
        const mainTitle = document.getElementById('main-title');
        const insightCounter = document.getElementById('insight-counter');
        const chaosMetricDisplay = document.getElementById('chaos-metric-display');

        const levelTitles = {
            0: 'Blueprint Chalamandra‚Ñ¢',
            2: 'üåÄ SRAP Flow Premium',
            3: 'üå™ Caos Controlado: Labs',
            5: 'üé© Mandala Multiconsciente VIP'
        };

        // Modal elements
        const customModal = document.getElementById('custom-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');

        // === 3. FUNCIONES DE UI Y ALERTA PERSONALIZADA ===

        // Reemplazo de alert() con un modal estilizado
        function showCustomAlert(message, title = '¬°Notificaci√≥n Warrior!') {
            modalTitle.textContent = title;
            modalMessage.innerHTML = message;
            customModal.classList.remove('hidden');
            customModal.classList.add('flex');
        }

        function hideCustomAlert() {
            customModal.classList.add('hidden');
            customModal.classList.remove('flex');
        }

        // Actualiza el contador global y la m√©trica de caos
        function updateUI() {
            insightCounter.textContent = gameState.insightPoints;
            
            // L√≥gica de la M√©trica de Desmadre/Caos (Premium)
            // Esto es una medida de cu√°nto caos has generado vs. cu√°nto Insight tienes.
            const totalActivity = Object.keys(gameState.collectedSteps).length + gameState.epicDisasterLevel + Object.keys(gameState.collectedHats).length;
            const flowControl = totalActivity > 0 ? (gameState.insightPoints / totalActivity).toFixed(2) : 0;
            
            chaosMetricDisplay.innerHTML = 
                `Desastre √âpico: <span class="text-red-400">${gameState.epicDisasterLevel}</span> | Flow Control (Ratio Insight/Actividad): <span class="${flowControl > 1.5 ? 'text-lime-400' : 'text-yellow-400'}">${flowControl}</span>`;
            
            // Refrescar estado de los pasos SRAP
            document.querySelectorAll('.srap-step').forEach(step => {
                const stepId = step.id;
                if (gameState.collectedSteps[stepId]) {
                    step.classList.add('srap-active');
                    step.style.cursor = 'default';
                } else {
                    step.classList.remove('srap-active');
                    step.style.cursor = 'pointer';
                }
            });

            // Refrescar estado de los sombreros
            document.querySelectorAll('.mandala-hat').forEach(hat => {
                const hatType = hat.id.replace('hat-', '');
                if (gameState.collectedHats[hatType]) {
                    // Si ya est√° activo, permitimos que el usuario lo active/desactive visualmente
                    hat.style.borderColor = 'var(--neon-lime)'; 
                } else {
                     hat.style.borderColor = 'var(--neon-purple)';
                }
            });

            // Actualizar barra de navegaci√≥n
            Object.keys(gameState.unlockedLevels).forEach(level => {
                const btn = document.getElementById(`nav-btn-${level}`);
                const isLocked = !gameState.unlockedLevels[level];
                if (btn) {
                    btn.classList.toggle('nav-locked', isLocked);
                    btn.classList.toggle('nav-active', parseInt(level) === gameState.currentLevel);
                    btn.disabled = isLocked;
                }
            });
        }

        // === 4. FUNCIONES DE NAVEGACI√ìN Y FLUJO L√ìGICO ===

        // Renderiza el nivel actual (llamado por la navegaci√≥n)
        function renderLevel(level) {
            level = parseInt(level);
            
            if (!gameState.unlockedLevels[level]) {
                showCustomAlert(`¬°Calma, carnal! El Nivel ${level} est√° bloqueado. Termina la tarea anterior para avanzar.`, 'Acceso Restringido');
                return; 
            }

            gameState.currentLevel = level;
            
            // Ocultar todos y mostrar el activo
            levelSections.forEach(section => {
                section.classList.add('hidden');
            });
            
            const activeSection = document.getElementById(`level-${level}`);
            if (activeSection) {
                activeSection.classList.remove('hidden');
            }

            // Actualizar t√≠tulo y UI
            mainTitle.textContent = levelTitles[level];
            updateUI();
        }

        // Desbloquea un nivel y luego lo renderiza (llamado por los CTAs de avance)
        function unlockAndRenderLevel(level) {
            gameState.unlockedLevels[level] = true;
            renderLevel(level);
        }

        // === 5. GAMIFICACI√ìN (L√≥gica de Interacci√≥n Premium) ===

        // Nivel 2: Pasos SRAP (Ahora con diferentes puntos de Insight)
        function collectInsight(element, stepId, points) {
            if (gameState.collectedSteps[stepId]) {
                 showCustomAlert(`Ya dominaste este paso SRAP: ${stepId}. Busca el siguiente Insight.`, 'Paso Completo');
                 return;
            }

            // Ganar punto
            gameState.insightPoints += points;
            gameState.collectedSteps[stepId] = true;
            
            // Mensaje de recompensa
            let message = `¬°Paso SRAP **${stepId.toUpperCase()}** completado! Has ganado **${points} Insights**.`;
            
            if (points === 2) {
                message += '<br/><span class="text-lime-500 font-bold">¬°Doble Insight por la Intenci√≥n Poderosa!</span>';
            }

            // Refuerza el mensaje de dominio por pr√°ctica
            message += `<br/><br/>**REGLA:** El sistema registra tu click asumiendo que **completaste la Tarea de Reflexi√≥n** asociada. ¬°Bien jugado, Warrior!`;


            showCustomAlert(message, 'SRAP Dominado');
            updateUI();
        }

        // Nivel 3: Rituales de Caos (Impacto en la M√©trica de Desmadre y Riesgo/Recompensa)
        function startChaosRitual(ritualType) {
            let insightGained = 0;
            let title = 'Ritual Activado';
            let message = '';

            // Mensaje base de la regla de dominio por pr√°ctica
            let practiceRule = `<br/><br/>**REGLA:** El sistema registra tu click asumiendo que **ejecutaste este Ritual de Caos** en un problema real. ¬°Sigue rompiendo el patr√≥n!`;


            if (ritualType === 'error') {
                gameState.epicDisasterLevel += 1;
                title = 'üí• Error Creativo (Riesgo)';
                
                // Simulaci√≥n de Riesgo/Recompensa con 30% de super-recompensa (+5) y 20% de penalizaci√≥n (-2)
                const roll = Math.random(); 
                
                if (roll < 0.3) {
                    insightGained = 5; // Super Insight
                    message = `¬°**SUPER INSIGHT**! El error te dio una visi√≥n √©pica. Ganaste **+${insightGained} Insights**.`;
                } else if (roll < 0.5) {
                    insightGained = -2; // Penalizaci√≥n de Caos
                    gameState.insightPoints += insightGained; // Aplicar la penalizaci√≥n directamente
                    message = `¬°**CHAOS FEEDBACK**! Perdiste ${Math.abs(insightGained)} Insights. El caos te record√≥ que el aprendizaje duele.`;
                } else {
                    insightGained = 1; // Recompensa base
                    message = `¬°Orale! Ganaste **+${insightGained} Insight** por atreverte al caos.`;
                }

            } else if (ritualType === 'fiesta') {
                gameState.epicDisasterLevel += 2;
                insightGained = 2; // Fiesta siempre garantiza Insights
                title = 'üåÆ Fiesta Estrat√©gica (Seguro)';
                message = `¬°Fiesta completa! **Desastre √âpico** incrementa. Ganaste **+${insightGained} Insights** garantizados.`;
            }
            
            if (insightGained >= 0) {
                 gameState.insightPoints += insightGained;
            }

            const epicDisasterMessage = `**Desastre √âpico** actual: ${gameState.epicDisasterLevel}.`;
            
            showCustomAlert(message + '<br/><br/>' + epicDisasterMessage + practiceRule, title);
            updateUI();
        }

        // Funci√≥n para verificar la sinergia del Mandala (Creativo -> Cr√≠tico -> T√°ctico)
        function checkMandalaSynergy() {
            const requiredSequence = ['creativo', 'critico', 'tactico'];
            
            // Chequea si la secuencia actual contiene la requerida
            if (gameState.hatSequence.length >= 3) {
                const lastThree = gameState.hatSequence.slice(-3); // Get the last 3 activated hats
                
                // Check if the last three match the required pattern
                if (JSON.stringify(lastThree) === JSON.stringify(requiredSequence)) {
                    // Synergy achieved! Reset sequence and grant bonus
                    const bonus = 10;
                    gameState.insightPoints += bonus;
                    gameState.hatSequence = []; // Resetear la secuencia despu√©s de la sinergia
                    
                    showCustomAlert(`üéâ ¬°SINERGIA CHALAMANDRA ACTIVADA! üéâ Has pasado del CAOS (Creativo) al CONTROL (T√°ctico) perfectamente. **BONUS: +${bonus} Insights**.`, '¬°√âPICO COMBO!');
                    updateUI();
                    return true;
                }
            }
            return false;
        }


        // Nivel 5: Sombreros Mandala (Doble/Triple Insight por cada activaci√≥n + Sinergia)
        function revealHatInsight(element, hatType, insightText) {
            
            const isRevealed = element.classList.contains('hat-revealed');
            const points = 3; // Insights Premium por Sombrero

            // Si ya fue revelado, solo toggle visual del insight (para ocultar/mostrar tip)
            if (gameState.collectedHats[hatType]) {
                element.classList.toggle('hat-revealed', !isRevealed);
                
                // A√±adir a la secuencia solo si es la √∫ltima acci√≥n, para evitar secuencias largas y falsas.
                if (gameState.hatSequence[gameState.hatSequence.length - 1] !== hatType) {
                    gameState.hatSequence.push(hatType);
                }
                
                checkMandalaSynergy(); // Check synergy even if re-clicking
                return;
            }

            // Primera activaci√≥n: Ganar Insights y registrar
            gameState.insightPoints += points; 
            gameState.collectedHats[hatType] = true;
            gameState.hatSequence.push(hatType); // Add to sequence
            
            // Mostrar Insight
            element.classList.add('hat-revealed');
            
            // Refuerza el mensaje de dominio por perspectiva/rol
            let message = `¬°Sombrero **${hatType.toUpperCase()}** activado! Has ganado **+${points} Insights**. <br/><br/>**Tu Tarea:** ${insightText}`;
            message += `<br/><br/>**REGLA:** El sistema te premia por **cambiar tu Rol de Conciencia** y ejecutar la Tarea que se revela.`;
            
            showCustomAlert(message, 'Mandala Activo');
            
            checkMandalaSynergy(); // Check synergy
            updateUI();
        }

        // === 6. INICIALIZACI√ìN ===
        document.addEventListener('DOMContentLoaded', () => {
            renderLevel(0); // Iniciar siempre en el nivel 0
        });
    </script>
</body>
</html>
